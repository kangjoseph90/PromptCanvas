{"version":3,"file":"popup.js","sources":["../popup/popup.js"],"sourcesContent":["// PromptCanvas Popup Script\r\n// Manages template CRUD operations\r\n\r\nlet templates = [];\r\nlet currentEditId = null;\r\n\r\n// DOM Elements\r\nconst views = {\r\n  list: document.getElementById('templateListView'),\r\n  edit: document.getElementById('templateEditView'),\r\n  help: document.getElementById('helpView')\r\n};\r\n\r\nconst elements = {\r\n  templateList: document.getElementById('templateList'),\r\n  searchInput: document.getElementById('searchInput'),\r\n  newTemplateBtn: document.getElementById('newTemplateBtn'),\r\n  backBtn: document.getElementById('backBtn'),\r\n  editorTitle: document.getElementById('editorTitle'),\r\n  templateForm: document.getElementById('templateForm'),\r\n  templateName: document.getElementById('templateName'),\r\n  templateTrigger: document.getElementById('templateTrigger'),\r\n  templateJson: document.getElementById('templateJson'),\r\n  jsonStatus: document.getElementById('jsonStatus'),\r\n  cancelBtn: document.getElementById('cancelBtn'),\r\n  deleteBtn: document.getElementById('deleteBtn'),\r\n  helpBtn: document.getElementById('helpBtn'),\r\n  helpBackBtn: document.getElementById('helpBackBtn')\r\n};\r\n\r\n// Initialize\r\ndocument.addEventListener('DOMContentLoaded', init);\r\n\r\nasync function init() {\r\n  await loadTemplates();\r\n  renderTemplateList();\r\n  setupEventListeners();\r\n}\r\n\r\nasync function loadTemplates() {\r\n  try {\r\n    templates = await chrome.runtime.sendMessage({ type: 'GET_ALL_TEMPLATES' });\r\n  } catch (e) {\r\n    console.error('Failed to load templates:', e);\r\n    templates = [];\r\n  }\r\n}\r\n\r\nfunction renderTemplateList(filter = '') {\r\n  const filtered = templates.filter(t => \r\n    t.name.toLowerCase().includes(filter.toLowerCase()) ||\r\n    t.trigger.toLowerCase().includes(filter.toLowerCase())\r\n  );\r\n  \r\n  if (filtered.length === 0) {\r\n    elements.templateList.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <div class=\"empty-state-icon\">üìù</div>\r\n        <div class=\"empty-state-text\">\r\n          ${filter ? 'Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§' : 'ÌÖúÌîåÎ¶øÏù¥ ÏóÜÏäµÎãàÎã§.<br>ÏÉà ÌÖúÌîåÎ¶øÏùÑ ÎßåÎì§Ïñ¥Î≥¥ÏÑ∏Ïöî!'}\r\n        </div>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n  \r\n  elements.templateList.innerHTML = filtered.map(t => `\r\n    <div class=\"template-item\" data-id=\"${t.id}\">\r\n      <div class=\"template-info\">\r\n        <div class=\"template-name\">${escapeHtml(t.name)}</div>\r\n        <div class=\"template-trigger\">${escapeHtml(t.trigger)}</div>\r\n      </div>\r\n      <div class=\"template-actions\">\r\n        <button class=\"btn-icon\" data-action=\"edit\" data-id=\"${t.id}\" title=\"Ìé∏Ïßë\">‚úèÔ∏è</button>\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n}\r\n\r\nfunction setupEventListeners() {\r\n  // Search\r\n  elements.searchInput.addEventListener('input', (e) => {\r\n    renderTemplateList(e.target.value);\r\n  });\r\n  \r\n  // New template\r\n  elements.newTemplateBtn.addEventListener('click', () => {\r\n    openEditor(null);\r\n  });\r\n  \r\n  // Template list clicks\r\n  elements.templateList.addEventListener('click', (e) => {\r\n    const editBtn = e.target.closest('[data-action=\"edit\"]');\r\n    const templateItem = e.target.closest('.template-item');\r\n    \r\n    if (editBtn) {\r\n      openEditor(editBtn.dataset.id);\r\n    } else if (templateItem) {\r\n      openEditor(templateItem.dataset.id);\r\n    }\r\n  });\r\n  \r\n  // Back button\r\n  elements.backBtn.addEventListener('click', () => {\r\n    showView('list');\r\n  });\r\n  \r\n  // Cancel button\r\n  elements.cancelBtn.addEventListener('click', () => {\r\n    showView('list');\r\n  });\r\n  \r\n  // Delete button\r\n  elements.deleteBtn.addEventListener('click', async () => {\r\n    if (currentEditId && confirm('Ïù¥ ÌÖúÌîåÎ¶øÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {\r\n      await deleteTemplate(currentEditId);\r\n      showView('list');\r\n    }\r\n  });\r\n  \r\n  // Form submit\r\n  elements.templateForm.addEventListener('submit', async (e) => {\r\n    e.preventDefault();\r\n    await saveCurrentTemplate();\r\n  });\r\n  \r\n  // JSON validation on input\r\n  elements.templateJson.addEventListener('input', validateJson);\r\n  \r\n  // Help\r\n  elements.helpBtn.addEventListener('click', () => {\r\n    showView('help');\r\n  });\r\n  \r\n  elements.helpBackBtn.addEventListener('click', () => {\r\n    showView('edit');\r\n  });\r\n}\r\n\r\nfunction showView(viewName) {\r\n  Object.values(views).forEach(v => v.classList.remove('active'));\r\n  views[viewName].classList.add('active');\r\n}\r\n\r\nfunction openEditor(templateId) {\r\n  currentEditId = templateId;\r\n  \r\n  if (templateId) {\r\n    // Edit existing\r\n    const template = templates.find(t => t.id === templateId);\r\n    if (template) {\r\n      elements.editorTitle.textContent = 'ÌÖúÌîåÎ¶ø Ìé∏Ïßë';\r\n      elements.templateName.value = template.name;\r\n      elements.templateTrigger.value = template.trigger;\r\n      elements.templateJson.value = JSON.stringify(template.template, null, 2);\r\n      elements.deleteBtn.style.display = 'block';\r\n    }\r\n  } else {\r\n    // New template\r\n    elements.editorTitle.textContent = 'ÏÉà ÌÖúÌîåÎ¶ø';\r\n    elements.templateName.value = '';\r\n    elements.templateTrigger.value = '';\r\n    elements.templateJson.value = '';\r\n    elements.deleteBtn.style.display = 'none';\r\n  }\r\n  \r\n  elements.jsonStatus.textContent = '';\r\n  showView('edit');\r\n}\r\n\r\nfunction validateJson() {\r\n  const value = elements.templateJson.value.trim();\r\n  \r\n  if (!value) {\r\n    elements.jsonStatus.textContent = '';\r\n    elements.jsonStatus.className = 'hint json-status';\r\n    return false;\r\n  }\r\n  \r\n  try {\r\n    JSON.parse(value);\r\n    elements.jsonStatus.textContent = '‚úì Ïú†Ìö®Ìïú JSON';\r\n    elements.jsonStatus.className = 'hint json-status valid';\r\n    return true;\r\n  } catch (e) {\r\n    elements.jsonStatus.textContent = `‚úó JSON Ïò§Î•ò: ${e.message}`;\r\n    elements.jsonStatus.className = 'hint json-status invalid';\r\n    return false;\r\n  }\r\n}\r\n\r\nasync function saveCurrentTemplate() {\r\n  const name = elements.templateName.value.trim();\r\n  const trigger = elements.templateTrigger.value.trim();\r\n  const jsonStr = elements.templateJson.value.trim();\r\n  \r\n  // Validation\r\n  if (!name) {\r\n    alert('ÌÖúÌîåÎ¶ø Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');\r\n    elements.templateName.focus();\r\n    return;\r\n  }\r\n  \r\n  if (!trigger) {\r\n    alert('Ìä∏Î¶¨Í±∞ ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');\r\n    elements.templateTrigger.focus();\r\n    return;\r\n  }\r\n  \r\n  if (!trigger.startsWith('/')) {\r\n    alert('Ìä∏Î¶¨Í±∞ ÌÇ§ÏõåÎìúÎäî /Î°ú ÏãúÏûëÌï¥Ïïº Ìï©ÎãàÎã§.');\r\n    elements.templateTrigger.focus();\r\n    return;\r\n  }\r\n  \r\n  if (!jsonStr) {\r\n    alert('ÌÖúÌîåÎ¶ø JSONÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');\r\n    elements.templateJson.focus();\r\n    return;\r\n  }\r\n  \r\n  let templateObj;\r\n  try {\r\n    templateObj = JSON.parse(jsonStr);\r\n  } catch (e) {\r\n    alert('Ïú†Ìö®Ìïú JSON ÌòïÏãùÏù¥ ÏïÑÎãôÎãàÎã§.');\r\n    elements.templateJson.focus();\r\n    return;\r\n  }\r\n  \r\n  // Check for duplicate trigger (except current template)\r\n  const existingTrigger = templates.find(t => t.trigger === trigger && t.id !== currentEditId);\r\n  if (existingTrigger) {\r\n    alert(`Ìä∏Î¶¨Í±∞ \"${trigger}\"Îäî Ïù¥ÎØ∏ Îã§Î•∏ ÌÖúÌîåÎ¶øÏóêÏÑú ÏÇ¨Ïö© Ï§ëÏûÖÎãàÎã§.`);\r\n    elements.templateTrigger.focus();\r\n    return;\r\n  }\r\n  \r\n  // Add meta to template\r\n  templateObj._meta = {\r\n    name,\r\n    trigger,\r\n    outputFormat: 'json'\r\n  };\r\n  \r\n  const templateData = {\r\n    id: currentEditId,\r\n    name,\r\n    trigger,\r\n    template: templateObj\r\n  };\r\n  \r\n  try {\r\n    await chrome.runtime.sendMessage({ type: 'SAVE_TEMPLATE', template: templateData });\r\n    await loadTemplates();\r\n    renderTemplateList();\r\n    showView('list');\r\n  } catch (e) {\r\n    console.error('Failed to save template:', e);\r\n    alert('ÌÖúÌîåÎ¶ø Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');\r\n  }\r\n}\r\n\r\nasync function deleteTemplate(id) {\r\n  try {\r\n    await chrome.runtime.sendMessage({ type: 'DELETE_TEMPLATE', id });\r\n    await loadTemplates();\r\n    renderTemplateList();\r\n  } catch (e) {\r\n    console.error('Failed to delete template:', e);\r\n    alert('ÌÖúÌîåÎ¶ø ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');\r\n  }\r\n}\r\n\r\nfunction escapeHtml(str) {\r\n  const div = document.createElement('div');\r\n  div.textContent = str;\r\n  return div.innerHTML;\r\n}\r\n"],"names":[],"mappings":"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"}