{"version":3,"file":"content-script.js","sources":["../src/ui/form-renderer.js","../src/content/form-injector.js","../src/content/index.js"],"sourcesContent":["// PromptCanvas - Form Renderer\r\n// Dynamically renders form fields based on template schema\r\n\r\n/**\r\n * Parse a marker string like \"$input:Label\" or \"$select:opt1|opt2|opt3\"\r\n * Returns: { type: 'input'|'select'|'array'|'static', label: string, options?: string[], schema?: string }\r\n */\r\nexport function parseMarker(value) {\r\n  if (typeof value !== 'string') {\r\n    return { type: 'static', value };\r\n  }\r\n\r\n  // Check for marker patterns\r\n  if (value === '$input') {\r\n    return { type: 'input' };\r\n  }\r\n\r\n  const selectMatch = value.match(/^\\$select:(.+)$/);\r\n  if (selectMatch) {\r\n    const options = selectMatch[1].split('|').map(o => o.trim());\r\n    return { type: 'select', label: options[0], options };\r\n  }\r\n\r\n  const arrayMatch = value.match(/^\\$array:(.+)$/);\r\n  if (arrayMatch) {\r\n    return { type: 'array', schemaName: arrayMatch[1] };\r\n  }\r\n\r\n  // No marker - static value\r\n  return { type: 'static', value };\r\n}\r\n\r\n/**\r\n * Render a form field based on parsed marker\r\n */\r\nexport function renderField(key, marker, defaultValue = '', path = '') {\r\n  const fieldId = `pc-field-${path}${key}`.replace(/\\./g, '-');\r\n\r\n  switch (marker.type) {\r\n    case 'input':\r\n      return `\r\n        <div class=\"promptcanvas-field\">\r\n          <label class=\"promptcanvas-label\" for=\"${fieldId}\">${key}</label>\r\n          <input type=\"text\" \r\n                 class=\"promptcanvas-input\" \r\n                 id=\"${fieldId}\" \r\n                 data-path=\"${path}${key}\"\r\n                 value=\"${escapeHtml(defaultValue)}\"\r\n                 placeholder=\"${key}\">\r\n        </div>\r\n      `;\r\n\r\n    case 'select':\r\n      const datalistId = `${fieldId}-list`;\r\n      const optionsHtml = marker.options.map(opt =>\r\n        `<option value=\"${escapeHtml(opt)}\">`\r\n      ).join('');\r\n      return `\r\n        <div class=\"promptcanvas-field\">\r\n          <label class=\"promptcanvas-label\" for=\"${fieldId}\">${key}</label>\r\n          <input type=\"text\" \r\n                 class=\"promptcanvas-input promptcanvas-select\" \r\n                 id=\"${fieldId}\" \r\n                 list=\"${datalistId}\"\r\n                 data-path=\"${path}${key}\"\r\n                 value=\"${escapeHtml(defaultValue)}\"\r\n                 placeholder=\"ì„ íƒ ë˜ëŠ” ì§ì ‘ ìž…ë ¥...\">\r\n          <datalist id=\"${datalistId}\">\r\n            ${optionsHtml}\r\n          </datalist>\r\n        </div>\r\n      `;\r\n\r\n    case 'static':\r\n      return `\r\n        <div class=\"promptcanvas-field\">\r\n          <label class=\"promptcanvas-label\">${key}</label>\r\n          <div class=\"promptcanvas-static\" data-path=\"${path}${key}\" data-static=\"true\">${escapeHtml(marker.value)}</div>\r\n        </div>\r\n      `;\r\n\r\n    default:\r\n      return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Render an array field with add/remove functionality\r\n */\r\nexport function renderArrayField(key, schemaName, schemas, items = [], path = '') {\r\n  const arrayPath = `${path}${key}`;\r\n  const schema = schemas[schemaName] || schemas[`$schemas.${schemaName}`];\r\n\r\n  let itemsHtml = '';\r\n\r\n  // Render existing items (allow empty arrays - length 0)\r\n  items.forEach((item, index) => {\r\n    itemsHtml += renderArrayItem(key, index, schema, schemas, item, arrayPath);\r\n  });\r\n\r\n  return `\r\n    <div class=\"promptcanvas-section\">\r\n      <div class=\"promptcanvas-section-header\">\r\n        <span class=\"promptcanvas-section-title\">${key}</span>\r\n      </div>\r\n      <div class=\"promptcanvas-array-container\" data-array=\"${arrayPath}\" data-schema=\"${schemaName}\">\r\n        ${itemsHtml}\r\n        <button type=\"button\" class=\"promptcanvas-add-btn\" data-add-to=\"${arrayPath}\">\r\n          <span>+</span> ${key} ì¶”ê°€\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render a single array item\r\n */\r\nexport function renderArrayItem(key, index, schema, schemas, values = {}, arrayPath = '') {\r\n  const itemPath = `${arrayPath}[${index}].`;\r\n\r\n  let fieldsHtml = '';\r\n\r\n  // Handle simple string schema (e.g., \"$input:Label\")\r\n  if (typeof schema === 'string') {\r\n    const marker = parseMarker(schema);\r\n    // Extract the actual value: could be string, or object with 'value' key, or undefined\r\n    let defaultValue = '';\r\n    if (typeof values === 'string') {\r\n      defaultValue = values;\r\n    } else if (values && typeof values === 'object' && 'value' in values) {\r\n      defaultValue = values.value;\r\n    }\r\n    fieldsHtml = renderField('value', marker, defaultValue, itemPath);\r\n  } else {\r\n    // Handle object schema\r\n    for (const [fieldKey, fieldValue] of Object.entries(schema)) {\r\n      const marker = parseMarker(fieldValue);\r\n      fieldsHtml += renderField(fieldKey, marker, values[fieldKey] || '', itemPath);\r\n    }\r\n  }\r\n\r\n  return `\r\n    <div class=\"promptcanvas-array-item\" data-array-item=\"${arrayPath}\" data-index=\"${index}\">\r\n      <div class=\"promptcanvas-array-item-header\">\r\n        <span class=\"promptcanvas-array-item-title\">#${index + 1}</span>\r\n        <button type=\"button\" class=\"promptcanvas-array-item-delete\" data-delete-from=\"${arrayPath}\" data-index=\"${index}\">\r\n          ðŸ—‘ ì‚­ì œ\r\n        </button>\r\n      </div>\r\n      ${fieldsHtml}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render a nested object\r\n */\r\nexport function renderNestedObject(key, obj, schemas, values = {}, path = '') {\r\n  const nestedPath = `${path}${key}.`;\r\n  let fieldsHtml = '';\r\n\r\n  for (const [fieldKey, fieldValue] of Object.entries(obj)) {\r\n    // Skip $schemas and _meta\r\n    if (fieldKey.startsWith('$') || fieldKey === '_meta') continue;\r\n\r\n    if (typeof fieldValue === 'object' && fieldValue !== null && !Array.isArray(fieldValue)) {\r\n      // Nested object\r\n      fieldsHtml += renderNestedObject(fieldKey, fieldValue, schemas, values[fieldKey] || {}, nestedPath);\r\n    } else {\r\n      const marker = parseMarker(fieldValue);\r\n      if (marker.type === 'array') {\r\n        fieldsHtml += renderArrayField(fieldKey, marker.schemaName, schemas, values[fieldKey] || [], nestedPath);\r\n      } else {\r\n        fieldsHtml += renderField(fieldKey, marker, values[fieldKey] || '', nestedPath);\r\n      }\r\n    }\r\n  }\r\n\r\n  return `\r\n    <div class=\"promptcanvas-section\">\r\n      <div class=\"promptcanvas-section-header\">\r\n        <span class=\"promptcanvas-section-title\">${key}</span>\r\n      </div>\r\n      <div class=\"promptcanvas-nested\">\r\n        ${fieldsHtml}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render the complete form from a template\r\n */\r\nexport function renderForm(template, values = {}) {\r\n  let html = '';\r\n  const schemas = template.$schemas || {};\r\n\r\n  // Also check for schemas defined with dot notation\r\n  for (const [key, value] of Object.entries(template)) {\r\n    if (key.startsWith('$schemas.')) {\r\n      schemas[key] = value;\r\n    }\r\n  }\r\n\r\n  for (const [key, value] of Object.entries(template)) {\r\n    // Skip meta fields and schema definitions\r\n    if (key === '_meta' || key === '$schemas' || key.startsWith('$schemas.')) continue;\r\n\r\n    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\r\n      // Nested object\r\n      html += renderNestedObject(key, value, schemas, values[key] || {}, '');\r\n    } else {\r\n      const marker = parseMarker(value);\r\n      if (marker.type === 'array') {\r\n        html += renderArrayField(key, marker.schemaName, schemas, values[key] || [], '');\r\n      } else {\r\n        html += `<div class=\"promptcanvas-section\">${renderField(key, marker, values[key] || '', '')}</div>`;\r\n      }\r\n    }\r\n  }\r\n\r\n  return html;\r\n}\r\n\r\n/**\r\n * Collect form values from DOM\r\n */\r\nexport function collectFormValues(container) {\r\n  const result = {};\r\n\r\n  // Collect regular inputs and selects\r\n  container.querySelectorAll('.promptcanvas-input, .promptcanvas-select, .promptcanvas-textarea').forEach(el => {\r\n    const path = el.dataset.path;\r\n    if (path) {\r\n      setNestedValue(result, path, el.value);\r\n    }\r\n  });\r\n\r\n  // Collect static values\r\n  container.querySelectorAll('[data-static=\"true\"]').forEach(el => {\r\n    const path = el.dataset.path;\r\n    if (path) {\r\n      setNestedValue(result, path, el.textContent);\r\n    }\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Generate final JSON output from template and values\r\n */\r\nexport function generateOutput(template, values) {\r\n  const output = {};\r\n\r\n  // Collect all schemas including dot notation\r\n  const allSchemas = { ...(template.$schemas || {}) };\r\n  for (const [key, value] of Object.entries(template)) {\r\n    if (key.startsWith('$schemas.')) {\r\n      const schemaName = key.replace('$schemas.', '');\r\n      allSchemas[schemaName] = value;\r\n    }\r\n  }\r\n\r\n  for (const [key, value] of Object.entries(template)) {\r\n    // Skip meta fields and schema definitions\r\n    if (key === '_meta' || key === '$schemas' || key.startsWith('$schemas.')) continue;\r\n\r\n    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\r\n      // Nested object - recursively process\r\n      output[key] = generateOutputObject(value, values[key] || {}, allSchemas);\r\n    } else {\r\n      const marker = parseMarker(value);\r\n      if (marker.type === 'array') {\r\n        const arrValues = values[key] || [];\r\n        // Check if this is a simple string schema (not object schema)\r\n        const schemaValue = allSchemas[marker.schemaName];\r\n        if (typeof schemaValue === 'string') {\r\n          // Simple string schema - extract just the value strings\r\n          output[key] = arrValues.map(item => {\r\n            if (typeof item === 'string') return item;\r\n            if (item && typeof item === 'object' && 'value' in item) return item.value;\r\n            return '';\r\n          });\r\n        } else {\r\n          output[key] = arrValues;\r\n        }\r\n      } else if (marker.type === 'static') {\r\n        output[key] = marker.value;\r\n      } else {\r\n        output[key] = values[key] || '';\r\n      }\r\n    }\r\n  }\r\n\r\n  return output;\r\n}\r\n\r\nfunction generateOutputObject(obj, values, schemas) {\r\n  const output = {};\r\n\r\n  for (const [key, value] of Object.entries(obj)) {\r\n    if (key.startsWith('$')) continue;\r\n\r\n    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\r\n      output[key] = generateOutputObject(value, values[key] || {}, schemas);\r\n    } else {\r\n      const marker = parseMarker(value);\r\n      if (marker.type === 'array') {\r\n        const arrValues = values[key] || [];\r\n        // Check if this is a simple string schema (not object schema)\r\n        const schemaValue = schemas[marker.schemaName];\r\n        if (typeof schemaValue === 'string') {\r\n          // Simple string schema - extract just the value strings\r\n          output[key] = arrValues.map(item => {\r\n            if (typeof item === 'string') return item;\r\n            if (item && typeof item === 'object' && 'value' in item) return item.value;\r\n            return '';\r\n          });\r\n        } else {\r\n          output[key] = arrValues;\r\n        }\r\n      } else if (marker.type === 'static') {\r\n        output[key] = marker.value;\r\n      } else {\r\n        output[key] = values[key] || '';\r\n      }\r\n    }\r\n  }\r\n\r\n  return output;\r\n}\r\n\r\n// Utility functions\r\nfunction escapeHtml(str) {\r\n  if (typeof str !== 'string') return str;\r\n  const div = document.createElement('div');\r\n  div.textContent = str;\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction setNestedValue(obj, path, value) {\r\n  // Parse path like \"character[0].name\" or \"style.mood\"\r\n  const regex = /([^.\\[\\]]+)|\\[(\\d+)\\]/g;\r\n  const parts = [];\r\n  let match;\r\n\r\n  while ((match = regex.exec(path)) !== null) {\r\n    if (match[1] !== undefined) {\r\n      parts.push(match[1]);\r\n    } else if (match[2] !== undefined) {\r\n      parts.push(parseInt(match[2], 10));\r\n    }\r\n  }\r\n\r\n  let current = obj;\r\n  for (let i = 0; i < parts.length - 1; i++) {\r\n    const part = parts[i];\r\n    const nextPart = parts[i + 1];\r\n\r\n    if (current[part] === undefined) {\r\n      current[part] = typeof nextPart === 'number' ? [] : {};\r\n    }\r\n    current = current[part];\r\n  }\r\n\r\n  current[parts[parts.length - 1]] = value;\r\n}\r\n","// PromptCanvas - Form Injector\r\n// Injects the modal form UI into web pages\r\n\r\nimport { renderForm, renderArrayItem, collectFormValues, generateOutput, parseMarker } from '../ui/form-renderer.js';\r\n\r\nlet currentOverlay = null;\r\nlet currentTemplate = null;\r\nlet currentTargetElement = null;\r\nlet currentTriggerText = '';\r\n\r\n/**\r\n * Show the form modal for a template\r\n */\r\nexport function showFormModal(template, targetElement, triggerText) {\r\n  // Remove any existing modal\r\n  hideFormModal();\r\n\r\n  currentTemplate = template;\r\n  currentTargetElement = targetElement;\r\n  currentTriggerText = triggerText;\r\n\r\n  // Create overlay\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'promptcanvas-overlay';\r\n  overlay.innerHTML = createModalHTML(template);\r\n\r\n  document.body.appendChild(overlay);\r\n  currentOverlay = overlay;\r\n\r\n  // Trigger animation\r\n  requestAnimationFrame(() => {\r\n    overlay.classList.add('visible');\r\n  });\r\n\r\n  // Setup event listeners\r\n  setupEventListeners(overlay, template);\r\n\r\n  // Focus first input\r\n  const firstInput = overlay.querySelector('.promptcanvas-input, .promptcanvas-select');\r\n  if (firstInput) {\r\n    setTimeout(() => firstInput.focus(), 100);\r\n  }\r\n}\r\n\r\n/**\r\n * Hide the form modal\r\n */\r\nexport function hideFormModal() {\r\n  if (currentOverlay) {\r\n    currentOverlay.classList.remove('visible');\r\n    setTimeout(() => {\r\n      if (currentOverlay && currentOverlay.parentNode) {\r\n        currentOverlay.parentNode.removeChild(currentOverlay);\r\n      }\r\n      currentOverlay = null;\r\n      currentTemplate = null;\r\n    }, 150);\r\n  }\r\n}\r\n\r\n/**\r\n * Create the modal HTML structure\r\n */\r\nfunction createModalHTML(template) {\r\n  const meta = template._meta || {};\r\n  const title = meta.name || 'PromptCanvas';\r\n\r\n  const formHtml = renderForm(template, {});\r\n\r\n  return `\r\n    <div class=\"promptcanvas-modal\">\r\n      <div class=\"promptcanvas-header\">\r\n        <h2 class=\"promptcanvas-title\">${escapeHtml(title)}</h2>\r\n        <button type=\"button\" class=\"promptcanvas-close\" data-action=\"close\">âœ•</button>\r\n      </div>\r\n      <div class=\"promptcanvas-body\">\r\n        <form class=\"promptcanvas-form\">\r\n          ${formHtml}\r\n        </form>\r\n        <div class=\"promptcanvas-preview\" style=\"display: none;\"></div>\r\n      </div>\r\n      <div class=\"promptcanvas-footer\">\r\n        <button type=\"button\" class=\"promptcanvas-btn promptcanvas-btn-preview\" data-action=\"preview\">ë¯¸ë¦¬ë³´ê¸°</button>\r\n        <button type=\"button\" class=\"promptcanvas-btn promptcanvas-btn-secondary\" data-action=\"close\">ì·¨ì†Œ</button>\r\n        <button type=\"button\" class=\"promptcanvas-btn promptcanvas-btn-primary\" data-action=\"insert\">ì‚½ìž…</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Setup event listeners for the modal\r\n */\r\nfunction setupEventListeners(overlay, template) {\r\n  const schemas = template.$schemas || {};\r\n\r\n  // Also get dot notation schemas\r\n  for (const [key, value] of Object.entries(template)) {\r\n    if (key.startsWith('$schemas.')) {\r\n      const schemaName = key.replace('$schemas.', '');\r\n      schemas[schemaName] = value;\r\n    }\r\n  }\r\n\r\n  // Close button and backdrop click\r\n  overlay.addEventListener('click', (e) => {\r\n    if (e.target === overlay || e.target.dataset.action === 'close') {\r\n      hideFormModal();\r\n    }\r\n  });\r\n\r\n  // Action buttons\r\n  overlay.addEventListener('click', (e) => {\r\n    const action = e.target.dataset.action;\r\n\r\n    if (action === 'insert') {\r\n      insertGeneratedOutput();\r\n    } else if (action === 'preview') {\r\n      togglePreview(overlay, template);\r\n    }\r\n  });\r\n\r\n  // Add array item buttons\r\n  overlay.addEventListener('click', (e) => {\r\n    const addTo = e.target.dataset.addTo || e.target.closest('[data-add-to]')?.dataset.addTo;\r\n    if (addTo) {\r\n      addArrayItem(overlay, addTo, schemas);\r\n    }\r\n  });\r\n\r\n  // Delete array item buttons\r\n  overlay.addEventListener('click', (e) => {\r\n    const deleteBtn = e.target.closest('[data-delete-from]');\r\n    if (deleteBtn) {\r\n      deleteArrayItem(overlay, deleteBtn.dataset.deleteFrom, parseInt(deleteBtn.dataset.index, 10));\r\n    }\r\n  });\r\n\r\n  // Keyboard shortcuts\r\n  overlay.addEventListener('keydown', (e) => {\r\n    if (e.key === 'Escape') {\r\n      hideFormModal();\r\n    } else if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {\r\n      insertGeneratedOutput();\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Add a new array item\r\n */\r\nfunction addArrayItem(overlay, arrayPath, schemas) {\r\n  const container = overlay.querySelector(`[data-array=\"${arrayPath}\"]`);\r\n  if (!container) return;\r\n\r\n  const schemaName = container.dataset.schema;\r\n  const schema = schemas[schemaName];\r\n\r\n  // Count existing items\r\n  const existingItems = container.querySelectorAll(`[data-array-item=\"${arrayPath}\"]`);\r\n  const newIndex = existingItems.length;\r\n\r\n  // Get the key from the path (last part before any brackets)\r\n  const key = arrayPath.split('.').pop().replace(/\\[\\d+\\]$/, '');\r\n\r\n  // Create new item HTML\r\n  const itemHtml = renderArrayItem(key, newIndex, schema, schemas, {}, arrayPath);\r\n\r\n  // Insert before the add button\r\n  const addBtn = container.querySelector(`[data-add-to=\"${arrayPath}\"]`);\r\n  const tempDiv = document.createElement('div');\r\n  tempDiv.innerHTML = itemHtml;\r\n  const newItem = tempDiv.firstElementChild;\r\n\r\n  container.insertBefore(newItem, addBtn);\r\n\r\n  // Focus first input in new item\r\n  const firstInput = newItem.querySelector('.promptcanvas-input, .promptcanvas-select');\r\n  if (firstInput) {\r\n    firstInput.focus();\r\n  }\r\n}\r\n\r\n/**\r\n * Delete an array item\r\n */\r\nfunction deleteArrayItem(overlay, arrayPath, index) {\r\n  const container = overlay.querySelector(`[data-array=\"${arrayPath}\"]`);\r\n  if (!container) return;\r\n\r\n  // Find and remove the item\r\n  const itemToRemove = container.querySelector(`[data-array-item=\"${arrayPath}\"][data-index=\"${index}\"]`);\r\n  if (itemToRemove) {\r\n    itemToRemove.remove();\r\n\r\n    // Re-index remaining items\r\n    const remainingItems = container.querySelectorAll(`[data-array-item=\"${arrayPath}\"]`);\r\n    remainingItems.forEach((item, newIndex) => {\r\n      item.dataset.index = newIndex;\r\n      const title = item.querySelector('.promptcanvas-array-item-title');\r\n      if (title) {\r\n        title.textContent = `#${newIndex + 1}`;\r\n      }\r\n      const deleteBtn = item.querySelector('[data-delete-from]');\r\n      if (deleteBtn) {\r\n        deleteBtn.dataset.index = newIndex;\r\n      }\r\n\r\n      // Update field paths\r\n      item.querySelectorAll('[data-path]').forEach(field => {\r\n        field.dataset.path = field.dataset.path.replace(/\\[\\d+\\]/, `[${newIndex}]`);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Toggle preview panel\r\n */\r\nfunction togglePreview(overlay, template) {\r\n  const previewPanel = overlay.querySelector('.promptcanvas-preview');\r\n  const previewBtn = overlay.querySelector('[data-action=\"preview\"]');\r\n\r\n  if (previewPanel.style.display === 'none') {\r\n    const values = collectFormValues(overlay);\r\n    const output = generateOutput(template, values);\r\n    previewPanel.textContent = JSON.stringify(output, null, 2);\r\n    previewPanel.style.display = 'block';\r\n    previewBtn.textContent = 'ë¯¸ë¦¬ë³´ê¸° ë‹«ê¸°';\r\n  } else {\r\n    previewPanel.style.display = 'none';\r\n    previewBtn.textContent = 'ë¯¸ë¦¬ë³´ê¸°';\r\n  }\r\n}\r\n\r\n/**\r\n * Insert the generated output into the target element\r\n */\r\nfunction insertGeneratedOutput() {\r\n  if (!currentTemplate || !currentTargetElement) return;\r\n\r\n  const values = collectFormValues(currentOverlay);\r\n  const output = generateOutput(currentTemplate, values);\r\n  const jsonString = JSON.stringify(output, null, 2);\r\n\r\n  // Get current value and find trigger position\r\n  const currentValue = currentTargetElement.value || '';\r\n  const triggerIndex = currentValue.lastIndexOf(currentTriggerText);\r\n\r\n  if (triggerIndex >= 0) {\r\n    // Replace trigger with output\r\n    const before = currentValue.substring(0, triggerIndex);\r\n    const after = currentValue.substring(triggerIndex + currentTriggerText.length);\r\n    currentTargetElement.value = before + jsonString + after;\r\n  } else {\r\n    // Just append\r\n    currentTargetElement.value = currentValue + jsonString;\r\n  }\r\n\r\n  // Trigger input event for frameworks that listen to it\r\n  currentTargetElement.dispatchEvent(new Event('input', { bubbles: true }));\r\n  currentTargetElement.dispatchEvent(new Event('change', { bubbles: true }));\r\n\r\n  hideFormModal();\r\n  currentTargetElement.focus();\r\n}\r\n\r\nfunction escapeHtml(str) {\r\n  if (typeof str !== 'string') return str;\r\n  const div = document.createElement('div');\r\n  div.textContent = str;\r\n  return div.innerHTML;\r\n}\r\n","// PromptCanvas - Content Script Entry Point\r\n// This file imports modular components and initializes the extension\r\n\r\nimport { showFormModal, hideFormModal } from './form-injector.js';\r\n\r\n// ===== Storage Functions =====\r\nasync function getAllTriggers() {\r\n  try {\r\n    const response = await chrome.runtime.sendMessage({ type: 'GET_ALL_TRIGGERS' });\r\n    return response || [];\r\n  } catch (e) {\r\n    console.warn('PromptCanvas: Failed to get triggers', e);\r\n    return [];\r\n  }\r\n}\r\n\r\nasync function getTemplateByTrigger(trigger) {\r\n  try {\r\n    return await chrome.runtime.sendMessage({ type: 'GET_TEMPLATE_BY_TRIGGER', trigger });\r\n  } catch (e) {\r\n    console.warn('PromptCanvas: Failed to get template', e);\r\n    return null;\r\n  }\r\n}\r\n\r\n// ===== Trigger Detection =====\r\nlet triggers = [];\r\n\r\nasync function init() {\r\n  triggers = await getAllTriggers();\r\n  \r\n  chrome.runtime.onMessage.addListener((message) => {\r\n    if (message.type === 'TRIGGERS_UPDATED') {\r\n      triggers = message.triggers || [];\r\n    }\r\n  });\r\n  \r\n  document.addEventListener('keydown', handleKeydown, true);\r\n}\r\n\r\nfunction handleKeydown(e) {\r\n  if (e.key === ' ' || e.key === 'Tab') {\r\n    const target = e.target;\r\n    \r\n    if (isTextInput(target)) {\r\n      const triggerInfo = detectTrigger(target);\r\n      \r\n      if (triggerInfo) {\r\n        e.preventDefault();\r\n        activateTrigger(triggerInfo.trigger, target, triggerInfo.fullMatch);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction detectTrigger(element) {\r\n  const value = getInputValue(element);\r\n  if (!value) return null;\r\n  \r\n  const cursorPos = getCursorPosition(element);\r\n  const textBeforeCursor = value.substring(0, cursorPos);\r\n  \r\n  for (const trigger of triggers) {\r\n    if (textBeforeCursor.endsWith(trigger)) {\r\n      return { trigger, fullMatch: trigger, position: cursorPos - trigger.length };\r\n    }\r\n  }\r\n  \r\n  return null;\r\n}\r\n\r\nasync function activateTrigger(trigger, element, fullMatch) {\r\n  const template = await getTemplateByTrigger(trigger);\r\n  if (template && template.template) {\r\n    showFormModal(template.template, element, fullMatch);\r\n  }\r\n}\r\n\r\nfunction isTextInput(element) {\r\n  if (!element) return false;\r\n  \r\n  const tagName = element.tagName?.toLowerCase();\r\n  \r\n  if (tagName === 'textarea') return true;\r\n  if (tagName === 'input') {\r\n    const type = element.type?.toLowerCase();\r\n    return ['text', 'search', 'url', 'email', ''].includes(type);\r\n  }\r\n  \r\n  if (element.isContentEditable) return true;\r\n  \r\n  if (element.classList) {\r\n    const editorClasses = ['ProseMirror', 'ql-editor', 'ce-paragraph', 'notranslate'];\r\n    if (editorClasses.some(cls => element.classList.contains(cls))) return true;\r\n  }\r\n  \r\n  return false;\r\n}\r\n\r\nfunction getInputValue(element) {\r\n  if (element.isContentEditable) return element.textContent || '';\r\n  return element.value || '';\r\n}\r\n\r\nfunction getCursorPosition(element) {\r\n  if (element.isContentEditable) {\r\n    const selection = window.getSelection();\r\n    if (selection.rangeCount > 0) {\r\n      const range = selection.getRangeAt(0);\r\n      const preCaretRange = range.cloneRange();\r\n      preCaretRange.selectNodeContents(element);\r\n      preCaretRange.setEnd(range.endContainer, range.endOffset);\r\n      return preCaretRange.toString().length;\r\n    }\r\n    return 0;\r\n  }\r\n  return element.selectionEnd || 0;\r\n}\r\n\r\n// Initialize\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', init);\r\n} else {\r\n  init();\r\n}\r\n"],"names":["escapeHtml"],"mappings":"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"}